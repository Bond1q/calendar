(()=>{"use strict";var __webpack_modules__={31:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbsenceController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),absence_service_1=__webpack_require__(283),create_absence_dto_1=__webpack_require__(874),update_absence_dto_1=__webpack_require__(291);let AbsenceController=class AbsenceController{constructor(absenceService){this.absenceService=absenceService}getAllAbsence(){return this.absenceService.getAllAbsence()}createAbsence(absence){return this.absenceService.createAbsence(absence)}updateAbsence(id,absence){return this.absenceService.updateAbsence(id,absence)}deleteAbsence(id){return this.absenceService.deleteAbsence(id)}};tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],AbsenceController.prototype,"getAllAbsence",null),tslib_1.__decorate([(0,common_1.Post)(),(0,common_1.UsePipes)(common_1.ValidationPipe),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_b=void 0!==create_absence_dto_1.CreateAbsenceDto&&create_absence_dto_1.CreateAbsenceDto)?_b:Object]),tslib_1.__metadata("design:returntype",void 0)],AbsenceController.prototype,"createAbsence",null),tslib_1.__decorate([(0,common_1.Put)(":id"),(0,common_1.UsePipes)(common_1.ValidationPipe),tslib_1.__param(0,(0,common_1.Param)("id",common_1.ParseUUIDPipe)),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_c=void 0!==update_absence_dto_1.UpdateAbsenceDto&&update_absence_dto_1.UpdateAbsenceDto)?_c:Object]),tslib_1.__metadata("design:returntype",void 0)],AbsenceController.prototype,"updateAbsence",null),tslib_1.__decorate([(0,common_1.Delete)(":id"),(0,common_1.UsePipes)(common_1.ValidationPipe),tslib_1.__param(0,(0,common_1.Param)("id",common_1.ParseUUIDPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",void 0)],AbsenceController.prototype,"deleteAbsence",null),AbsenceController=tslib_1.__decorate([(0,common_1.Controller)("absence"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==absence_service_1.AbsenceService&&absence_service_1.AbsenceService)?_a:Object])],AbsenceController),exports.AbsenceController=AbsenceController},742:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Absence=void 0;const tslib_1=__webpack_require__(752),typeorm_1=__webpack_require__(250),types_1=__webpack_require__(426);let Absence=class Absence{};tslib_1.__decorate([(0,typeorm_1.Column)({type:"enum",enum:types_1.AbsenceTypes}),tslib_1.__metadata("design:type","function"==typeof(_a=void 0!==types_1.AbsenceTypes&&types_1.AbsenceTypes)?_a:Object)],Absence.prototype,"type",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type","function"==typeof(_b="undefined"!=typeof Date&&Date)?_b:Object)],Absence.prototype,"dateStart",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type","function"==typeof(_c="undefined"!=typeof Date&&Date)?_c:Object)],Absence.prototype,"dateEnd",void 0),tslib_1.__decorate([(0,typeorm_1.Column)(),tslib_1.__metadata("design:type",String)],Absence.prototype,"comment",void 0),tslib_1.__decorate([(0,typeorm_1.PrimaryGeneratedColumn)("uuid"),tslib_1.__metadata("design:type",String)],Absence.prototype,"id",void 0),Absence=tslib_1.__decorate([(0,typeorm_1.Entity)()],Absence),exports.Absence=Absence},836:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbsenceModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),typeorm_1=__webpack_require__(399),absence_controller_1=__webpack_require__(31),absence_model_1=__webpack_require__(742),absence_service_1=__webpack_require__(283);let AbsenceModule=class AbsenceModule{};AbsenceModule=tslib_1.__decorate([(0,common_1.Module)({imports:[typeorm_1.TypeOrmModule.forFeature([absence_model_1.Absence])],controllers:[absence_controller_1.AbsenceController],providers:[absence_service_1.AbsenceService]})],AbsenceModule),exports.AbsenceModule=AbsenceModule},283:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbsenceService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),typeorm_1=__webpack_require__(399),typeorm_2=__webpack_require__(250),absence_model_1=__webpack_require__(742),types_1=__webpack_require__(426),moment=__webpack_require__(245);let AbsenceService=class AbsenceService{constructor(absenceRepository){this.absenceRepository=absenceRepository}getAllAbsence(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.absenceRepository.find()}))}createAbsence(absence){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(absence.type!==types_1.AbsenceTypes.SICK&&moment(absence.dateStart).isBefore(moment(),"day"))throw new common_1.HttpException(`Cannot create absence with type: ${absence.type} in the past`,common_1.HttpStatus.BAD_REQUEST);if(0===(yield this.absenceRepository.find({where:{dateStart:(0,typeorm_2.Between)(moment(absence.dateStart).toDate(),moment(absence.dateEnd).toDate()),dateEnd:(0,typeorm_2.Between)(moment(absence.dateStart).toDate(),moment(absence.dateEnd).toDate())}})).length){const result=yield this.absenceRepository.insert(absence);return this.absenceRepository.findOneBy({id:result.raw[0].id})}throw new common_1.HttpException("There is absence in this period in database",common_1.HttpStatus.BAD_REQUEST)}))}updateAbsence(id,absence){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(0!==(yield this.absenceRepository.find({where:{dateStart:(0,typeorm_2.Between)(moment(absence.dateStart).toDate(),moment(absence.dateEnd).toDate()),dateEnd:(0,typeorm_2.Between)(moment(absence.dateStart).toDate(),moment(absence.dateEnd).toDate()),id:(0,typeorm_2.Not)(id)}})).length)throw new common_1.HttpException("There is absence in this period in database",common_1.HttpStatus.BAD_REQUEST);if((yield this.absenceRepository.update(id,absence)).affected)return this.absenceRepository.findOneBy({id});throw new common_1.HttpException("There is not such id in database",common_1.HttpStatus.BAD_REQUEST)}))}deleteAbsence(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if((yield this.absenceRepository.delete(id)).affected)return this.absenceRepository.findOneBy({id});throw new common_1.HttpException("There is not such id in database",common_1.HttpStatus.BAD_REQUEST)}))}};AbsenceService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,typeorm_1.InjectRepository)(absence_model_1.Absence)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==typeorm_2.Repository&&typeorm_2.Repository)?_a:Object])],AbsenceService),exports.AbsenceService=AbsenceService},874:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateAbsenceDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(849),types_1=__webpack_require__(426);class CreateAbsenceDto{}tslib_1.__decorate([(0,class_validator_1.IsEnum)(types_1.AbsenceTypes,{message:"Incorrect absence type"}),tslib_1.__metadata("design:type","function"==typeof(_a=void 0!==types_1.AbsenceTypes&&types_1.AbsenceTypes)?_a:Object)],CreateAbsenceDto.prototype,"type",void 0),tslib_1.__decorate([(0,class_validator_1.IsDateString)(),tslib_1.__metadata("design:type","function"==typeof(_b="undefined"!=typeof Date&&Date)?_b:Object)],CreateAbsenceDto.prototype,"dateStart",void 0),tslib_1.__decorate([(0,class_validator_1.IsDateString)(),tslib_1.__metadata("design:type","function"==typeof(_c="undefined"!=typeof Date&&Date)?_c:Object)],CreateAbsenceDto.prototype,"dateEnd",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)(),(0,class_validator_1.MinLength)(1),(0,class_validator_1.MaxLength)(200),tslib_1.__metadata("design:type",String)],CreateAbsenceDto.prototype,"comment",void 0),exports.CreateAbsenceDto=CreateAbsenceDto},291:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateAbsenceDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(849);class UpdateAbsenceDto{}tslib_1.__decorate([(0,class_validator_1.IsDateString)(),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],UpdateAbsenceDto.prototype,"dateStart",void 0),tslib_1.__decorate([(0,class_validator_1.IsDateString)(),tslib_1.__metadata("design:type","function"==typeof(_b="undefined"!=typeof Date&&Date)?_b:Object)],UpdateAbsenceDto.prototype,"dateEnd",void 0),exports.UpdateAbsenceDto=UpdateAbsenceDto},188:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),typeorm_1=__webpack_require__(399),config_1=__webpack_require__(793),absence_module_1=__webpack_require__(836),absence_model_1=__webpack_require__(742);let AppModule=class AppModule{};AppModule=tslib_1.__decorate([(0,common_1.Module)({imports:[config_1.ConfigModule.forRoot({envFilePath:".env"}),typeorm_1.TypeOrmModule.forRoot({type:"postgres",host:process.env.POSTGRES_HOST,port:Number(process.env.POSTGRES_PORT),username:process.env.POSTGRES_USER,password:process.env.POSTGRES_PASSWORD,database:process.env.POSTGRES_DB,entities:[absence_model_1.Absence],synchronize:!0}),absence_module_1.AbsenceModule],controllers:[],providers:[]})],AppModule),exports.AppModule=AppModule},426:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752);tslib_1.__exportStar(__webpack_require__(51),exports),tslib_1.__exportStar(__webpack_require__(376),exports)},51:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.sharedTypes=void 0,exports.sharedTypes=function(){return"shared-types"}},376:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbsenceTypes=void 0,function(AbsenceTypes){AbsenceTypes.SICK="sick",AbsenceTypes.VACATION="vacation"}(exports.AbsenceTypes||(exports.AbsenceTypes={}))},481:module=>{module.exports=require("@nestjs/common")},793:module=>{module.exports=require("@nestjs/config")},143:module=>{module.exports=require("@nestjs/core")},399:module=>{module.exports=require("@nestjs/typeorm")},849:module=>{module.exports=require("class-validator")},245:module=>{module.exports=require("moment")},752:module=>{module.exports=require("tslib")},250:module=>{module.exports=require("typeorm")}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),core_1=__webpack_require__(143),app_module_1=__webpack_require__(188);!function(){tslib_1.__awaiter(this,void 0,void 0,(function*(){const app=yield core_1.NestFactory.create(app_module_1.AppModule,{cors:!0}),port=process.env.PORT||3333;yield app.listen(port),common_1.Logger.log(`🚀 Application is running on: http://localhost:${port}`)}))}()})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=main.js.map